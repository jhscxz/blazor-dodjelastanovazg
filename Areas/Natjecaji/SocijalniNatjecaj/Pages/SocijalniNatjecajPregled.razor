@page "/socijalni/pregled/{NatjecajId:long}"
@using DodjelaStanovaZG.Areas.Natjecaji.SocijalniNatjecaj.DTO
@using DodjelaStanovaZG.Components.UI
@using DodjelaStanovaZG.Enums
@using MudBlazor
@using DodjelaStanovaZG.Areas.Natjecaji.SocijalniNatjecaj.Pages.Components
@inherits SocijalniNatjecajPregledBase

<Container BreadcrumbItems="BreadcrumbItems">
    <MudPaper Outlined="true" Class="pa-4">

        <div class="flex items-center gap-4 mb-4">
            <MudButton OnClick="@AddZahtjev"
                       Variant="Variant.Filled"
                       Color="Color.Default"
                       IconColor="Color.Success"
                       DropShadow="false"
                       StartIcon="@Icons.Material.Filled.Add"
                       Style="padding: 10px 18px;">
                DODAJ
            </MudButton>

            <div class="flex-1">
                <MudTextField Label="Pretraga zahtjeva"
                              Value="@SearchText"
                              ValueChanged="@(EventCallback.Factory.Create<string>(this, OnSearchChanged)!)"
                              Immediate="true"
                              DebounceInterval="300"
                              Variant="Variant.Outlined"
                              Margin="Margin.Dense"
                              Adornment="Adornment.Start"
                              AdornmentIcon="@Icons.Material.Filled.Search"
                              Class="w-full" />
            </div>

            <div class="flex-none w-[160px]">
                <MudSelect T="RezultatObrade?" Label="Osnovanost"
                           Value="@SelectedOsnovanost"
                           ValueChanged="@(EventCallback.Factory.Create<RezultatObrade?>(this, OnOsnovanostChanged))"
                           Variant="Variant.Outlined"
                           Margin="Margin.Dense"
                           Dense="true"
                           Class="w-[200px]">
                    <MudSelectItem T="RezultatObrade?" Value="null">Svi</MudSelectItem>
                    <MudSelectItem T="RezultatObrade?" Value="RezultatObrade.Nepotpun">Nepotpun</MudSelectItem>
                    <MudSelectItem T="RezultatObrade?" Value="RezultatObrade.Neosnovan">Neosnovan</MudSelectItem>
                    <MudSelectItem T="RezultatObrade?" Value="RezultatObrade.Osnovan">Osnovan</MudSelectItem>
                    <MudSelectItem T="RezultatObrade?" Value="RezultatObrade.Greška">Greška</MudSelectItem>
                </MudSelect>
            </div>
        </div>

        <MudTable T="SocijalniNatjecajZahtjevDto"
                  ServerData="LoadServerData"
                  TableLayout="TableLayout.Fixed"
                  Hover="true"
                  Striped="true"
                  Dense="true"
                  RowsPerPage="10"
                  Outlined="true"
                  Breakpoint="Breakpoint.Sm"
                  @ref="Table"
                  Class="rounded-lg overflow-hidden">

            <HeaderContent>
                <MudTh Class="table-header"></MudTh>
                <MudTh Class="table-header">Klasa predmeta</MudTh>
                <MudTh Class="table-header">Prezime i ime</MudTh>
                <MudTh Class="table-header">OIB</MudTh>
                <MudTh Class="table-header">Ukupno bodova</MudTh>
                <MudTh Class="table-header">Osnovanost</MudTh>
                <MudTh Class="table-header">Akcija</MudTh>
            </HeaderContent>

            <RowTemplate>
                <MudTd>
                    <MudIconButton Icon="@GetExpandIcon(context)"
                                   OnClick="@(() => ToggleExpand(context.Id))"
                                   Size="Size.Small" />
                </MudTd>
                <MudTd>@context.KlasaPredmeta</MudTd>
                <MudTd>@FormatString(context.ImePrezime)</MudTd>
                <MudTd>@FormatString(context.Oib)</MudTd>
                <MudTd>@FormatInt(context.Bodovi?.UkupnoBodova)</MudTd>
                <MudTd>@FormatOsnovanost(context.RezultatObrade)</MudTd>
                <MudTd>
                    <MudIconButton Icon="@Icons.Material.Filled.Info"
                                   Size="Size.Small"
                                   OnClick="@(() => NavigateToDetails(context))" />
                </MudTd>
            </RowTemplate>

            <ChildRowContent>
                @if (IsRowExpanded(context))
                {
                    <MudTd ColSpan="@TotalColumns">
                        <!-- sivi, zaobljeni kontejner -->
                        <MudPaper Elevation="0"
                                  Class="pa-4 rounded-lg"
                                  Style="background-color: #f5f5f5;">
                            <SocijalniZahtjevPregledContent Model="context" />
                        </MudPaper>
                    </MudTd>
                }
            </ChildRowContent>


            <PagerContent>
                <MudTablePager />
            </PagerContent>

        </MudTable>
    </MudPaper>
</Container>
